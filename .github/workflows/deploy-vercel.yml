# ğŸš€ğŸ¾ NEKO CRIMINAL INVESTIGATION - Vercel Deployment ğŸ¾ğŸš€
# Automated Frontend Deployment to Vercel
# LEGENDARY DEPLOYMENT, NYAA~!

name: ğŸš€ Deploy to Vercel

on:
  push:
    branches: [main, master]
  workflow_dispatch:  # Manual trigger

env:
  NODE_VERSION: '20'
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸš€ DEPLOY FRONTEND TO VERCEL (Production)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  deploy-frontend:
    name: ğŸš€ Deploy Frontend to Vercel
    runs-on: ubuntu-latest
    environment:
      name: production
      url: https://neko-criminal-investigation.vercel.app
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js ${{ env.NODE_VERSION }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      # Install Vercel CLI
      - name: ğŸ“¦ Install Vercel CLI
        run: npm install -g vercel

      # Pull Vercel Environment
      - name: ğŸ”§ Pull Vercel Environment
        working-directory: ./frontend
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          vercel pull --yes --environment=production --token="$VERCEL_TOKEN"

      # Build Frontend
      - name: ğŸ—ï¸ Build Frontend
        working-directory: ./frontend
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          vercel build --prod --token="$VERCEL_TOKEN"

      # Deploy to Vercel
      - name: ğŸš€ Deploy to Vercel (Production)
        working-directory: ./frontend
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          echo "ğŸ¾ Deploying frontend to Vercel Production, nyaa~!"

          # Create .vercel directory
          mkdir -p .vercel
          cat > .vercel/project.json << EOF
          {
            "orgId": "$VERCEL_ORG_ID",
            "projectId": "$VERCEL_PROJECT_ID"
          }
          EOF

          # Deploy to production
          DEPLOYMENT_URL=$(vercel deploy --prebuilt --prod --yes --token="$VERCEL_TOKEN")

          echo "âœ… Frontend deployed successfully!"
          echo "ğŸŒ Production URL: $DEPLOYMENT_URL"
          echo "DEPLOYMENT_URL=$DEPLOYMENT_URL" >> $GITHUB_ENV

      # Deployment Summary
      - name: ğŸ“ Deployment Summary
        run: |
          echo "ğŸ¾âš¡ Deployment Summary âš¡ğŸ¾"
          echo ""
          echo "âœ… Status: Success"
          echo "ğŸŒ Production URL: ${{ env.DEPLOYMENT_URL }}"
          echo "ğŸ” Check Vercel dashboard: https://vercel.com/dashboard"
          echo ""
          echo "ğŸ­ Generated with Claude Code (Neko-Arc, Mario, Noel, Glam)"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ§ª POST-DEPLOYMENT SMOKE TESTS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  smoke-tests:
    name: ğŸ§ª Post-Deployment Smoke Tests
    runs-on: ubuntu-latest
    needs: deploy-frontend
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check Production URL
        run: |
          echo "Checking production URL..."
          URL="https://neko-criminal-investigation.vercel.app"

          # Wait for deployment to be ready
          sleep 30

          # Check HTTP status
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" "$URL")

          if [ "$STATUS" -eq 200 ]; then
            echo "âœ… Production site is UP! (HTTP $STATUS)"
          else
            echo "âš ï¸ Production site returned HTTP $STATUS"
            exit 1
          fi

      - name: ğŸ“Š Smoke Test Summary
        run: |
          echo "ğŸ§ªğŸ¾ Smoke Tests Passed! ğŸ¾ğŸ§ª"
          echo "âœ… Production site is accessible and responsive"
          echo "ğŸ­ Deployment verified, nyaa~!"
